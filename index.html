<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diciembre Stereo | La casa de la parranda navide√±a</title>
  <meta name="description" content="Diciembre Stereo ‚Äì m√∫sica parrandera, tropical y navide√±a 24/7. ¬°S√∫bele volumen!" />
  <meta name="theme-color" content="#165936" />

  <!-- Iconos / favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://static.mytuner.mobi/media/tvos_radios/693/diciembre-stereo.eca6450d.png">
  <link rel="icon" type="image/png" sizes="192x192" href="https://static.mytuner.mobi/media/tvos_radios/693/diciembre-stereo.eca6450d.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://static.mytuner.mobi/media/tvos_radios/693/diciembre-stereo.eca6450d.png">

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{--green1:#0d2a1a;--green2:#165936;--red:#e53935;--gold:#f7d774;--white:#fff;}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Nunito',system-ui,Arial,sans-serif;
      color:var(--white);
      background:linear-gradient(160deg,var(--green1),var(--green2));
      min-height:100vh;overflow-x:hidden;position:relative
    }
    .container{max-width:1080px;margin:0 auto;padding:24px;text-align:center;position:relative;z-index:2}

    header{display:flex;flex-direction:column;align-items:center;gap:8px}
    .logo{height:140px;width:auto;filter:drop-shadow(0 6px 20px #0007)}
    h1{font-family:'Montserrat',sans-serif;font-size:clamp(1.6rem,1.2rem+2vw,3rem);margin:0}
    .tag{opacity:.95;margin:6px 0 0}

    /* ‚ùÑÔ∏è Nieve */
    .snow{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden}
    .flake{position:absolute;top:-10px;width:6px;height:6px;background:#fff;border-radius:50%;opacity:.85;filter:blur(.3px)}

    /* üéá Guirnalda superior multicolor reactiva */
    .garland{position:fixed;top:0;left:0;width:100%;height:52px;pointer-events:none;z-index:5}
    .garland::before{content:"";position:absolute;left:0;right:0;top:18px;height:4px;border-radius:2px;background:repeating-linear-gradient(90deg,#2b1b00 0 24px,#3a2605 24px 48px);opacity:.7;filter:drop-shadow(0 2px 3px #0007)}
    .bulb{position:absolute;top:6px;width:20px;height:20px;border-radius:50%;box-shadow:0 0 10px currentColor,0 0 22px currentColor;transform-origin:top center}
    .bulb:nth-child(odd){animation:twinkle 2.6s infinite ease-in-out alternate}
    .bulb:nth-child(even){animation:twinkle 3.4s infinite ease-in-out alternate}
    @keyframes twinkle{from{opacity:.55;filter:brightness(.9)}to{opacity:1;filter:brightness(1.3)}}
    .garland.beat .bulb{animation:twinkle 2s infinite ease-in-out alternate, pulse 1.05s infinite ease-in-out}
    @keyframes pulse{0%,100%{transform:translateY(0) rotate(-2deg);box-shadow:0 0 14px currentColor,0 0 28px currentColor}50%{transform:translateY(1px) rotate(2deg);box-shadow:0 0 26px currentColor,0 0 42px currentColor}}

    .audio-wrap{background:#072417;border:1px solid #ffffff20;border-radius:14px;padding:14px;margin:10px auto;width:100%;max-width:420px}
    audio{width:100%}
    #unmute{display:none;margin-top:12px;border:none;border-radius:24px;padding:12px 16px;font-weight:900;cursor:pointer;background:linear-gradient(180deg,var(--gold),#d8b24d);color:#3b2600;animation:pulsebtn 2.2s infinite ease-in-out}
    @keyframes pulsebtn{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}

    .solicita{margin-top:26px;padding:20px;border-radius:16px;background:linear-gradient(90deg,#e53935,#f7d774,#165936);background-size:400% 400%;animation:luces 4s linear infinite;box-shadow:0 0 25px #0008;}
    @keyframes luces{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .solicita h3{margin:0;font-family:'Montserrat';font-size:1.6rem;font-weight:900;text-shadow:0 0 10px #000}
    .solicita p{font-size:1.1rem;margin:8px 0 16px}
    .btn-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .btn{display:inline-block;padding:12px 22px;border-radius:30px;background:#fff;color:#b00000;font-weight:900;text-decoration:none;font-size:1.05rem;box-shadow:0 0 20px #ffb;background:linear-gradient(180deg,#fff6c0,#ffffff);transition:transform .2s ease,box-shadow .3s ease}
    .btn:hover{transform:scale(1.08);box-shadow:0 0 30px #ffd36b,0 0 60px #ff0000;}
    .btn.app{color:#2d1b00}

    .card{background:#00000050;border:1px solid #ffffff2a;border-radius:18px;padding:20px;margin-top:22px;backdrop-filter:blur(10px);box-shadow:0 14px 34px #0006;display:inline-block;text-align:center;width:min(100%,1080px)}
    .card h2{font-family:'Montserrat',sans-serif;margin:0 0 10px}
    .lead{opacity:.95}

    .countdown{display:grid;grid-template-columns:repeat(4,minmax(70px,1fr));gap:12px;justify-content:center;margin:14px auto;max-width:420px}
    .unit{background:#072417;border:1px solid #ffffff20;border-radius:14px;padding:12px;text-align:center}
    .num{font-family:'Montserrat',sans-serif;font-weight:900;font-size:clamp(1.4rem,1.1rem+1.4vw,2.4rem)}
    .label{opacity:.8;font-weight:800}

    /* üé∂ Top de la semana */
    .top{margin-top:22px;text-align:left}
    .song{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border:1px solid #ffffff20;border-radius:12px;background:#091f15}
    .song + .song{margin-top:10px}
    .left{display:flex;align-items:center;gap:12px}
    .pos{width:34px;height:34px;display:grid;place-items:center;border-radius:10px;background:linear-gradient(180deg,#ffd36b,#e0b44a);color:#2a1b00;font-weight:900}
    .title{font-weight:800}
    .artist{opacity:.85;font-size:.95rem}
    .ask{padding:8px 12px;border-radius:999px;border:0;background:#fff;color:#b00000;font-weight:900;cursor:pointer;text-decoration:none}
    .ask:hover{transform:translateY(-1px)}

    /* üéº Marquesina metadatos + car√°tula */
    .meta{overflow:hidden;white-space:nowrap;border:1px solid #ffffff20;background:#072417;border-radius:12px;margin:10px auto 0;max-width:420px;display:flex;align-items:center;gap:8px}
    .meta .inner{display:inline-block;padding:10px 14px;animation:scroll 14s linear infinite}
    .meta .label{opacity:.8;margin-right:6px}
    @keyframes scroll{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}

    /* üé® Car√°tula con brillo navide√±o reactivo */
    .meta img{
      width:54px;height:54px;object-fit:cover;border-radius:10px;margin-left:8px;
      display:none;box-shadow:0 0 10px #0008;transition:transform .6s ease, box-shadow .6s ease;
    }
    .meta img.shine{animation:coverGlow 3.2s ease-in-out infinite alternate}
    @keyframes coverGlow{
      0%{transform:scale(1);box-shadow:0 0 10px #0008,0 0 0 #00ff0033}
      100%{transform:scale(1.05);box-shadow:0 0 14px #0008,0 0 22px #ff000080}
    }

    footer{margin:36px 0 10px;text-align:center;opacity:.9;z-index:2;position:relative}
  </style>
</head>
<body>
  <!-- üéá Guirnalda superior -->
  <div class="garland" id="garland"></div>
  <!-- ‚ùÑÔ∏è Nieve -->
  <div class="snow" id="snow"></div>

  <div class="container">
    <header>
      <img class="logo" src="https://static.mytuner.mobi/media/tvos_radios/693/diciembre-stereo.eca6450d.png" alt="Logo Diciembre Stereo"/>
      <h1>Diciembre Stereo</h1>
      <p class="tag">Como aquellos diciembres ‚Ä¢ ¬°S√∫bele volumen! üéÑü•Å</p>
    </header>

    <section>
      <div class="audio-wrap">
        <audio id="radio" muted autoplay controls>
          <source src="https://c23.radioboss.fm:8195/stream" type="audio/mpeg" />
          Tu navegador no soporta audio HTML5.
        </audio>
      </div>
      <!-- Metadatos con marquesina y car√°tula -->
      <div class="meta" id="meta" style="display:none">
        <img id="cover" alt="Car√°tula"/>
        <div class="inner" id="metaText">üé∂ Sonando ahora...</div>
      </div>
      <button id="unmute">üîî Activar sonido</button>
    </section>

    <section class="solicita">
      <h3>üéµ ¬°Participa en vivo!</h3>
      <p>Pide tu canci√≥n, deja tu saludo y su√©ltate con la parranda por WhatsApp üì≤</p>
      <div class="btn-row">
        <a id="pedir" class="btn" href="https://wa.me/573052051610?text=Hola%20Diciembre%20Stereo%2C%20quiero%20pedir%20una%20canci%C3%B3n%20parrandera!" target="_blank">üí¨ Pedir Canci√≥n Ahora</a>
        <a class="btn app" href="https://play.google.com/store/apps/details?id=com.jhongalvan.diciembrest" target="_blank" rel="noopener">‚ñ∂Ô∏è Descarga la App</a>
      </div>
    </section>

    <section class="card top">
      <h2>üî• Top de la semana</h2>
      <p class="lead">Las m√°s pedidas por nuestros oyentes</p>
      <div id="top-list">
        <div class="song"><div class="left"><div class="pos">1</div><div><div class="title">La V√≠spera de A√±o Nuevo</div><div class="artist">Pastor L√≥pez</div></div></div><a class="ask" target="_blank" href="https://wa.me/573052051610?text=Quiero%20la%20canci%C3%B3n%3A%20La%20V%C3%ADspera%20de%20A%C3%B1o%20Nuevo%20-%20Pastor%20L%C3%B3pez">Pedir</a></div>
        <div class="song"><div class="left"><div class="pos">2</div><div><div class="title">A√±o Nuevo, Vida Nueva</div><div class="artist">Billos Caracas Boys</div></div></div><a class="ask" target="_blank" href="https://wa.me/573052051610?text=Quiero%20la%20canci%C3%B3n%3A%20A%C3%B1o%20Nuevo%2C%20Vida%20Nueva%20-%20Billos%20Caracas%20Boys">Pedir</a></div>
        <div class="song"><div class="left"><div class="pos">3</div><div><div class="title">Cinco Pa' Las Doce</div><div class="artist">N√©stor Zavarce</div></div></div><a class="ask" target="_blank" href="https://wa.me/573052051610?text=Quiero%20la%20canci%C3%B3n%3A%20Cinco%20Pa'%20Las%20Doce%20-%20N%C3%A9stor%20Zavarce">Pedir</a></div>
        <div class="song"><div class="left"><div class="pos">4</div><div><div class="title">El Burrito Sabanero</div><div class="artist">Juanes (versi√≥n)</div></div></div><a class="ask" target="_blank" href="https://wa.me/573052051610?text=Quiero%20la%20canci%C3%B3n%3A%20El%20Burrito%20Sabanero%20-%20Juanes">Pedir</a></div>
        <div class="song"><div class="left"><div class="pos">5</div><div><div class="title">Faltan Cinco pa' las Doce</div><div class="artist">Los 50 de Joselito</div></div></div><a class="ask" target="_blank" href="https://wa.me/573052051610?text=Quiero%20la%20canci%C3%B3n%3A%20Faltan%20Cinco%20pa'%20las%20Doce%20-%20Los%2050%20de%20Joselito">Pedir</a></div>
      </div>
    </section>

    <section class="card">
      <h2>Contador para diciembre</h2>
      <p class="lead">¬°Rumbo al <strong>1 de diciembre</strong>! üéÖ‚ú®</p>
      <div class="countdown" id="countdown">
        <div class="unit"><div class="num" id="d">--</div><div class="label">D√çAS</div></div>
        <div class="unit"><div class="num" id="h">--</div><div class="label">HORAS</div></div>
        <div class="unit"><div class="num" id="m">--</div><div class="label">MIN</div></div>
        <div class="unit"><div class="num" id="s">--</div><div class="label">SEG</div></div>
      </div>
    </section>

    <footer>
      ¬© <span id="year"></span> Diciembre Stereo ¬∑ Grupo Bacan√≠simo ¬∑ Medell√≠n & Colombia
    </footer>
  </div>

  <script>
    document.getElementById('year').textContent=new Date().getFullYear();

    // ‚ùÑÔ∏è Nieve animada
    (function(){
      const snow=document.getElementById('snow');
      for(let i=0;i<90;i++){
        const f=document.createElement('span');
        f.className='flake';
        f.style.left=Math.random()*100+'%';
        f.style.animation=`fall ${6+Math.random()*10}s linear ${Math.random()*6}s infinite`;
        f.style.width=f.style.height=2+Math.random()*6+'px';
        snow.appendChild(f);
      }
      const style=document.createElement('style');
      style.textContent='@keyframes fall{to{transform:translateY(105vh)}}';
      document.head.appendChild(style);
    })();

    // üéá Guirnalda superior de luces multicolor
    (function(){
      const g=document.getElementById('garland');
      const colors=['#ff3b3b','#66ff99','#7dc3ff','#ffd36b','#ff8bf2'];
      const total=48;
      for(let i=0;i<total;i++){
        const bulb=document.createElement('span');
        bulb.className='bulb';
        bulb.style.left=(i*(100/(total-1)))+'%';
        bulb.style.color=colors[i%colors.length];
        g.appendChild(bulb);
      }
    })();

    // üîä Autoplay con bot√≥n de activar sonido + sincron√≠a de luces
    const radio=document.getElementById('radio');
    const unmute=document.getElementById('unmute');
    const garland=document.getElementById('garland');
    function toggle(){unmute.style.display=radio.muted?'inline-block':'none'}
    function beat(){ if(!radio.muted && !radio.paused) garland.classList.add('beat'); else garland.classList.remove('beat'); }
    radio.addEventListener('play',()=>{toggle();beat();});
    radio.addEventListener('pause',beat);
    radio.addEventListener('volumechange',beat);
    document.addEventListener('click',()=>{radio.play().catch(()=>{});toggle();beat()},{once:true});
    unmute.addEventListener('click',()=>{radio.muted=false;radio.play();toggle();beat();new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_1df3d41474.mp3?filename=christmas-bells-111539.mp3').play();});

    // üîî Campanitas bot√≥n Pedir Canci√≥n (una vez por interacci√≥n)
    const pedir=document.getElementById('pedir');
    pedir.addEventListener('mouseenter',()=>{
      const bells=new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_1df3d41474.mp3?filename=christmas-bells-111539.mp3');
      bells.volume=0.6; bells.play();
    });

    // ‚è±Ô∏è Countdown al 1 de diciembre (cada a√±o)
    function nextDecFirst(){
      const now=new Date();
      const year= now.getMonth()>10||(now.getMonth()===10&&now.getDate()>30)?now.getFullYear()+1:now.getFullYear();
      return new Date(year,11,1,0,0,0,0);
    }
    function renderCountdown(){
      const target=nextDecFirst();
      const now=new Date();
      let diff=target-now;if(diff<0)diff=0;
      const sec=Math.floor(diff/1000);
      const d=Math.floor(sec/86400);
      const h=Math.floor((sec%86400)/3600);
      const m=Math.floor((sec%3600)/60);
      const s=sec%60;
      document.getElementById('d').textContent=d;
      document.getElementById('h').textContent=String(h).padStart(2,'0');
      document.getElementById('m').textContent=String(m).padStart(2,'0');
      document.getElementById('s').textContent=String(s).padStart(2,'0');
    }
    setInterval(renderCountdown,1000);renderCountdown();

    // üéº Metadatos con proxy + marquesina
    const metaWrap=document.getElementById('meta');
    const metaText=document.getElementById('metaText');
    const coverImg=document.getElementById('cover');
    function clean(s){return String(s||'').replace(/\s+/g,' ').trim();}
    function formatNow(title,artist){
      const t=clean(title), a=clean(artist);
      if(t && !a && t.includes(' - ')){
        const parts=t.split(' - '); if(parts.length>=2){ const tit=parts.slice(1).join(' - '); return `üé∂ Sonando ahora: "${clean(tit)}" ‚Äî ${clean(parts[0])}`; }
      }
      if(t && a) return `üé∂ Sonando ahora: "${t}" ‚Äî ${a}`;
      if(t) return `üé∂ Sonando ahora: "${t}"`;
      return null;
    }
    async function getMetadata(){
      const base='https://c23.radioboss.fm:8195';
      const direct=[
        base+'/status-json.xsl',
        base+'/status.xsl?json=1',
        base+'/stats?json=1',
        base+'/playing.html?sid=1',
        base+'/currentsong?sid=1',
        base+'/streamtitle?sid=1'
      ];
      const proxify=(u)=>[
        `https://r.jina.ai/http/${u.replace(/^https?:\\/\\//,'')}`,
        `https://r.jina.ai/https/${u.replace(/^https?:\\/\\//,'')}`,
        `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`
      ];
      const candidates=[...direct.flatMap(u=>[u,...proxify(u)])];
      for(const url of candidates){
        try{
          const r=await fetch(url,{mode:'cors'});
          if(!r.ok) continue;
          const ct=(r.headers.get('content-type')||'').toLowerCase();
          if(ct.includes('json')){
            const j=await r.json();
            if(j.icestats && j.icestats.source){
              const srcArr=Array.isArray(j.icestats.source)?j.icestats.source:[j.icestats.source];
              const src=srcArr.find(s=>String(s.listenurl||'').includes('/stream'))||srcArr[0];
              if(src){
                const t= src.title || src.song || src.streamtitle || '';
                const a= src.artist || '';
                const text = formatNow(t,a); if(text) return {text, title:t, artist:a};
              }
            }
            if(j.streamtitle||j.songtitle||j.title){
              const t = j.streamtitle||j.songtitle||j.title; const a = j.artist||'';
              const text = formatNow(t,a); if(text) return {text, title:t, artist:a};
            }
          } else {
            const txt=await r.text();
            const line = clean(txt.split(/\\n|<br\\s*\\/?>(?i)/)[0]||'');
            if(line){ const text = formatNow(line,'') || line; return {text, title:line, artist:''}; }
          }
        }catch(e){}
      }
      return null;
    }
    function parseTitleArtist(maybe){
      let title = '', artist = '';
      const s = clean(maybe);
      if(!s) return {title,artist};
      if(s.includes(' ‚Äî ')){
        const p=s.split(' ‚Äî '); if(p.length>=2){ return {title:clean(p[0].replace(/^.*Sonando ahora:\\s*"?/i,'')), artist:clean(p.slice(1).join(' ‚Äî '))}; }
      }
      if(s.includes(' - ')){
        const p=s.split(' - '); if(p.length>=2){ return {artist:clean(p[0]), title:clean(p.slice(1).join(' - '))}; }
      }
      const m = s.match(/Sonando ahora:\\s*"(.+?)"\\s*[‚Äî-]\\s*(.+)$/i);
      if(m) return {title:clean(m[1]), artist:clean(m[2])};
      return {title:s, artist:''};
    }
    async function refreshMeta(){
      const res=await getMetadata();
      if(res && res.text){
        metaText.textContent=res.text;
        metaWrap.style.display='flex';
        const pa = parseTitleArtist(res.text);
        fetchCover(clean(`${pa.title} ${pa.artist}`));
      }
    }
    refreshMeta();
    setInterval(refreshMeta,15000);

    // üé® Car√°tula (iTunes Search) + brillo navide√±o CSS
    async function fetchCover(term){
      if(!term){ coverImg.style.display='none'; coverImg.classList.remove('shine'); return; }
      try{
        const r = await fetch('https://itunes.apple.com/search?media=music&limit=1&term=' + encodeURIComponent(term));
        const j = await r.json();
        if(j && j.results && j.results.length){
          let url = j.results[0].artworkUrl100 || j.results[0].artworkUrl60;
          if(url){
            url = url.replace(/100x100bb\\.(jpg|png)/,'300x300bb.$1');
            coverImg.src = url;
            coverImg.style.display = 'block';
            coverImg.classList.add('shine');
            return;
          }
        }
      }catch(e){}
      coverImg.style.display='none';
      coverImg.classList.remove('shine');
    }

    // ‚ú® Brillo de car√°tula reactivo al ritmo
    (function(){
      const cover = document.getElementById('cover');
      const audio = document.getElementById('radio');
      if(!cover || !audio) return;
      try{ audio.crossOrigin = audio.crossOrigin || 'anonymous'; }catch(e){}
      let ctx, analyser, src, data, raf;
      function initCtx(){
        if(ctx) return true;
        try{
          ctx = new (window.AudioContext||window.webkitAudioContext)();
          analyser = ctx.createAnalyser();
          analyser.fftSize = 1024;
          data = new Uint8Array(analyser.frequencyBinCount);
          src = ctx.createMediaElementSource(audio);
          src.connect(analyser);
          src.connect(ctx.destination);
          return true;
        }catch(err){ return false; }
      }
      function level(){
        if(!analyser) return 0;
        analyser.getByteFrequencyData(data);
        let sum=0; for(let i=0;i<data.length;i++){ sum += data[i]; }
        return sum / data.length / 255;
      }
      function loop(){
        const v = level();
        const scale = 1 + v*0.10;
        const red   = Math.min(255, Math.floor(80 + v*175));
        const green = Math.min(255, Math.floor(80 + 175 * Math.max(v,0.2)));
        const glow1 = `0 0 14px #0008`;
        const glow2 = `0 0 ${Math.floor(26 + v*28)}px rgba(${red},0,0,0.8)`;
        const glow3 = `0 0 ${Math.floor(20 + v*24)}px rgba(0,${green},0,0.7)`;
        cover.style.transform = `scale(${scale.toFixed(3)})`;
        cover.style.boxShadow = `${glow1}, ${glow2}, ${glow3}`;
        raf = requestAnimationFrame(loop);
      }
      function startReactive(){ if(!initCtx()) return; if(ctx.state === 'suspended') ctx.resume().catch(()=>{}); if(!raf) raf = requestAnimationFrame(loop); }
      function stopReactive(){ if(raf){ cancelAnimationFrame(raf); raf=null; } cover.style.boxShadow = '0 0 10px #0008, 0 0 18px #ff000066, 0 0 18px #00ff0066'; cover.style.transform = 'scale(1.02)'; }
      document.addEventListener('click', startReactive, {once:true});
      audio.addEventListener('play',  startReactive);
      audio.addEventListener('pause', stopReactive);
    })();

    // üéá Guirnalda reactiva al ritmo
    (function(){
      const audio = document.getElementById('radio');
      const garland = document.getElementById('garland');
      if(!audio || !garland) return;
      try{ audio.crossOrigin = audio.crossOrigin || 'anonymous'; }catch(e){}
      let ctx, analyser, src, data, raf;
      function initCtx(){
        if(ctx) return true;
        try{
          ctx = new (window.AudioContext||window.webkitAudioContext)();
          analyser = ctx.createAnalyser();
          analyser.fftSize = 1024;
          data = new Uint8Array(analyser.frequencyBinCount);
          src = ctx.createMediaElementSource(audio);
          src.connect(analyser);
          src.connect(ctx.destination);
          return true;
        }catch(err){ return false; }
      }
      const bulbs = ()=> Array.from(garland.querySelectorAll('.bulb'));
      function energy(){
        if(!analyser) return 0;
        analyser.getByteFrequencyData(data);
        let sum=0, count=0;
        for(let i=2;i<Math.min(80,data.length);i++){ sum += data[i]; count++; }
        const avg = count? (sum/count)/255 : 0;
        return Math.min(1, Math.max(0, avg));
      }
      function loop(){
        const v = energy();
        const now = performance.now();
        const bs = bulbs();
        for(let i=0;i<bs.length;i++){
          const b = bs[i];
          const phase = (Math.sin((now/250)+(i*0.9))+1)/2;
          const k = 0.3 + 0.9*v*phase;
          const blur = Math.floor(10 + k*24);
          const y = (phase*2 - 1) * (v*2);
          b.style.transform = `translateY(${y.toFixed(2)}px)`;
          b.style.boxShadow = `0 0 ${blur}px currentColor, 0 0 ${Math.floor(blur*1.6)}px currentColor`;
          b.style.opacity = (0.6 + 0.4*k).toFixed(2);
        }
        raf = requestAnimationFrame(loop);
      }
      function start(){ if(!initCtx()) return; if(ctx.state==='suspended') ctx.resume().catch(()=>{}); if(!raf) raf=requestAnimationFrame(loop); }
      function stop(){ if(raf){ cancelAnimationFrame(raf); raf=null; } }
      document.addEventListener('click', start, {once:true});
      audio.addEventListener('play', start);
      audio.addEventListener('pause', stop);
    })();
  </script>
</body>
</html>
